# Use the official Golang image as a builder stage
FROM golang:1.22.3 AS builder
 
# Set the working directory inside the container
WORKDIR /opt/app
 
# Copy the Go module files
COPY go.mod .
COPY go.sum .
 
# Download Go dependencies
RUN go mod download
 
# Copy the main.go file into the container
COPY main.go .
 
# Build the Go application
RUN go build -o webapp-producer main.go
 
# Start a new stage from scratch
FROM golang:1.22.3
 
# Set the working directory inside the container
WORKDIR /opt/app
 
# Copy the compiled binary from the builder stage
COPY --from=builder /opt/app/webapp-producer .
 
# Run the executable
CMD ["./webapp-producer"]