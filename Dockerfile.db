# Start from the Flyway base image
FROM flyway/flyway:latest

ARG username
ENV db_username $username

ARG password
ENV db_password $password

# # Install Flyway dependencies and OpenJDK
RUN apt-get update && \
    apt-get install -y openjdk-11-jdk 

# ENV PATH="/opt/homebrew/opt/openjdk/bin:$PATH"

# Copy the migration scripts and configuration
COPY ./db/sql /flyway/sql
COPY ./db/flyway.conf /flyway/conf/flyway.conf

# Entry point to allow running Flyway commands
ENTRYPOINT ["flyway"]

CMD ["-url=jdbc:postgresql://host.docker.internal:5432/cve", "-user=$db_username", "-password=$db_password", "migrate"]

