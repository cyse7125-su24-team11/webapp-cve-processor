# Start from the Flyway base image
FROM flyway/flyway:latest

# RUN echo "$JAVA_HOME"
# Install Flyway dependencies and OpenJDK
RUN apt-get update && \
    apt-get install -y openjdk-11-jdk 

# ENV PATH="/opt/homebrew/opt/openjdk/bin:$PATH"

# Copy the migration scripts and configuration
COPY ./sql /flyway/sql
COPY ./flyway.conf /flyway/conf/flyway.conf

# Entry point to allow running Flyway commands
ENTRYPOINT ["flyway"]

CMD ["-url=jdbc:postgresql://host.docker.internal:5432/cve", "-user=postgres", "-password=postgres", "migrate"]

